<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Wurfindex</title>
    <script src="js/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="onsenui/css/onsenui.css" />
    <link rel="stylesheet" type="text/css" href="onsenui/css/onsen-css-components.min.css" />
    <ons-icon size="30px" style="margin-left: 10px; margin-top: 10px;" icon="md-arrow-back" onclick="BackButton()"></ons-icon>
    <ons-page>
        <ons-toolbar>
            <div class="left">
                <ons-icon size="30px" style="margin-left: 10px" icon="md-arrow-back" onclick="BackButton()"></ons-icon>
            </div>
            <div class="center">Wurfindex</div>
            <div class="right"></div>
        </ons-toolbar>
        <ons-list ng-controller="DialogController">
            <ons-list-item onclick="showTemplateDialog('occupancy', 'occupancy.html', '#CreatedOnOccupancyDate', '#CreatedOnOccupancyTime')" modifier="chevron" tappable>
                Belegung
            </ons-list-item>
            <ons-list-item onclick="showTemplateDialog('pregnancy', 'pregnancy.html', '#CreatedOnPregnancyDate', '#CreatedOnPregnancyTime')" modifier="chevron" tappable>
                Trächtigkeitsuntersuchung
            </ons-list-item>
            <ons-list-item onclick="showTemplateDialog('farrow', 'farrow.html', '#CreatedOnFarrowDate', '#CreatedOnFarrowTime')" modifier="chevron" tappable>
                Abferkeln
            </ons-list-item>
            <ons-list-item onclick="showTemplateDialog('stripOff', 'stripOff.html', '#CreatedOnStripOffDate', '#CreatedOnStripOffTime')" modifier="chevron" tappable>
                Absetzen
            </ons-list-item>
            <ons-list-item modifier="chevron" tappable>
                BCS Analyse
            </ons-list-item>
        </ons-list>
    </ons-page>
</head>

<template id="occupancy.html">
    <ons-dialog id="occupancy" cancelable>
        <div style="text-align: center; padding: 5px;">
            <p>
                <b>
                    Belegung
                </b>
            </p>
        </div>
        <ons-row style="margin-top: 15px">
            <ons-col style="margin-left: 5%; margin-top: 5px">Uhrzeit</ons-col>
            <ons-col>
                <ons-input id="CreatedOnOccupancyTime" style="margin-left: 5%; width:80px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col style="margin-left: 5%; margin-top: 5px">Datum</ons-col>
            <ons-col>
                <ons-input id="CreatedOnOccupancyDate" type="date" value="tt.mm.jjjj " name="CreatedOn" style="margin-left: 5%; width:120px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <div style="text-align: center; padding: 5px;">
            <p>
                <ons-button style="background-color: green; width: 70px;" onclick="saveDialog('occupancy', 'Belegung', 'CreatedOnOccupancyDate', 'CreatedOnOccupancyTime')">
                    <ons-icon icon="fa-check"></ons-icon>
                </ons-button>
                <ons-button style="background-color: red; width: 70px;" onclick="hideDialog('occupancy')">
                    <ons-icon icon="fa-trash"></ons-icon>
                </ons-button>
            </p>
        </div>
    </ons-dialog>
</template>

<template id="pregnancy.html">
    <ons-dialog id="pregnancy" cancelable>
        <div style="text-align: center; padding: 5px;">
            <p>
                <b>
                    Untersuchung
                </b>
            </p>
        </div>
        <ons-row style="margin-top: 15px">
            <ons-col style="margin-left: 5%; margin-top: 5px">Uhrzeit</ons-col>
            <ons-col>
                <ons-input id="CreatedOnPregnancyTime" style="margin-left: 5%; width:80px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col style="margin-left: 5%; margin-top: 5px">Datum</ons-col>
            <ons-col>
                <ons-input id="CreatedOnPregnancyDate" type="date" value="tt.mm.jjjj " name="CreatedOn" style="margin-left: 5%; width:120px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <div style="text-align: center; padding: 5px;">
            <p>
                <ons-button style="background-color: green; width: 70px;" onclick="saveDialog('pregnancy', 'Trächtigkeitsuntersuchung', 'CreatedOnPregnancyDate', 'CreatedOnPregnancyTime')">
                    <ons-icon icon="fa-check"></ons-icon>
                </ons-button>
                <ons-button style="background-color: red; width: 70px;" onclick="hideDialog('pregnancy')">
                    <ons-icon icon="fa-trash"></ons-icon>
                </ons-button>
            </p>
        </div>
    </ons-dialog>
</template>

<template id="stripOff.html">
    <ons-dialog id="stripOff" cancelable>
        <div style="text-align: center; padding: 5px;">
            <p>
                <b>
                    Absetzen am
                </b>
            </p>
        </div>
        <ons-row style="margin-top: 15px">
            <ons-col style="margin-left: 5%; margin-top: 5px">Uhrzeit</ons-col>
            <ons-col>
                <ons-input id="CreatedOnStripOffTime" style="margin-left: 5%; width:80px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col style="margin-left: 5%; margin-top: 5px">Datum</ons-col>
            <ons-col>
                <ons-input id="CreatedOnStripOffDate" type="date" value="tt.mm.jjjj " name="CreatedOn" style="margin-left: 5%; width:120px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <div style="text-align: center; padding: 5px;">
            <p>
                <ons-button style="background-color: green; width: 70px;" onclick="saveDialog('stripOff', 'Absetzen', 'CreatedOnStripOffDate', 'CreatedOnStripOffTime')">
                    <ons-icon icon="fa-check"></ons-icon>
                </ons-button>
                <ons-button style="background-color: red; width: 70px;" onclick="hideDialog('stripOff')">
                    <ons-icon icon="fa-trash"></ons-icon>
                </ons-button>
            </p>
        </div>
    </ons-dialog>
</template>

<template id="farrow.html">
    <ons-dialog id="farrow" cancelable>
        <div style="text-align: center; padding: 5px;">
            <p>
                <b>
                    Abferkeln
                </b>
            </p>
        </div>
        <ons-row style="margin-top: 5px">
            <ons-col style="margin-left: 5%; margin-top: 5px">Lebend geboren</ons-col>
            <ons-col>
                <ons-input id="BornAlive" placeholder="0" type="number" style="margin-left: 5%; width:80px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col style="margin-left: 5%; margin-top: 5px">Tot geboren</ons-col>
            <ons-col>
                <ons-input id="BornDead" placeholder="0" type="number" style="margin-left: 5%; width:80px;"></ons-input>
            </ons-col>
        </ons-row>
        <ons-row style="margin-top: 15px">
            <ons-col style="margin-left: 5%; margin-top: 5px">Uhrzeit</ons-col>
            <ons-col>
                <ons-input id="CreatedOnFarrowTime" style="margin-left: 5%; width:80px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col style="margin-left: 5%; margin-top: 5px">Datum</ons-col>
            <ons-col>
                <ons-input id="CreatedOnFarrowDate" type="date" value="tt.mm.jjjj " name="CreatedOn" style="margin-left: 5%; width:120px;"></ons-input><br><br>
            </ons-col>
        </ons-row>
        <div style="text-align: center; padding: 10px;">
            <p>
                <ons-button style="background-color: green; width: 70px;" onclick="saveDialog('farrow', 'Abgeferkelt', 'CreatedOnFarrowDate', 'CreatedOnFarrowTime')">
                    <ons-icon icon="fa-check"></ons-icon>
                </ons-button>
                <ons-button style="background-color: red; width: 70px;" onclick="hideDialog('farrow')">
                    <ons-icon icon="fa-trash"></ons-icon>
                </ons-button>
            </p>
        </div>
    </ons-dialog>
</template>

<body>

    <script type="text/javascript">
        db = window.openDatabase("Database", "1.0", "Nutztier DB", 20 * 1024 * 1024); //create 20MB Database
        var born_alive = "";
        var born_dead = "";

        var showTemplateDialog = function(my_dialog, my_dialog_html, CreatedOnDate, CreatedOnTime) {

            var dialog = document.getElementById(my_dialog);

            if (dialog) {
                dialog.show();
            } else {
                ons.createElement(my_dialog_html, {
                        append: true
                    })
                    .then(function(dialog) {
                        dialog.show();
                        let date = new Date().toISOString().substr(0, 10);
                        var time = new Date().toLocaleTimeString()
                        document.querySelector(CreatedOnDate).value = date;
                        document.querySelector(CreatedOnTime).value = time.substr(0, 5);
                    });
            }
        };

        var hideDialog = function(id) {
            document.getElementById(id).hide();
        };

        var saveDialog = function(id, type, CreatedOnDate, CreatedOnTime) {
            if (id == 'farrow') {
                var born_alive = document.getElementById("BornAlive").value;
                var born_dead = document.getElementById("BornDead").value;
                if (document.getElementById("BornAlive").value.length != 0) {
                    var born_alive = document.getElementById("BornAlive").value;
                } else {
                    ons.notification.alert({
                        message: 'Bitte überprüfe das Eingabefeld "Lebend geboren"!',
                        title: 'Eingabefelder Fehler',
                    });
                    return
                }
                if (document.getElementById("BornDead").value.length != 0) {
                    var born_dead = document.getElementById("BornDead").value;
                } else {
                    ons.notification.alert({
                        message: 'Bitte überprüfe das Eingabefeld "Tot geboren"!',
                        title: 'Eingabefelder Fehler',
                    });
                    return
                }
            }
            write2DB(type, CreatedOnDate, CreatedOnTime)
        };

        function write2DB(type, CreatedOnDate, CreatedOnTime) {
            var color = String(localStorage.LivestockColor)
            var number = String(localStorage.LivestockNumber)
            var date = document.getElementById(CreatedOnDate).value;
            var time = document.getElementById(CreatedOnTime).value;
            db.transaction(function(transaction) {
                var executeQuery =
                    "INSERT INTO livestock_action (color, number, type, date, time, born_alive, born_dead, sync) VALUES (?,?,?,?,?,?,?,?)";
                transaction.executeSql(executeQuery, [color, number, type, date, time, born_alive, born_dead, "true"],
                    function(tx, result) {
                        window.location = "livestock_detail.html";
                        //                        window.location == "window.history.back()"
                    },
                    function(error) {
                        alert('Error: ' + error.message + ' code: ' + error.code);
                    });
            });
        }

        function BackButton() {
            window.location == "window.history.back()"
            //            window.location = "livestock_detail.html ";
        }

    </script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="onsenui/js/onsenui.min.js"></script>

</body>

</html>
